#!/bin/sh

# Ð¯ÐºÑ‰Ð¾ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ Ð±Ð°Ð³Ð°Ñ‚Ð¾ Ñ‚Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ðµ Ð¼Ð¾Ð¶Ðµ Ð½Ðµ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ÑÑŒ. Ð Ñ–Ð´ÐºÐ¾, Ð°Ð»Ðµ ÑÑ‚Ð°Ñ”Ñ‚ÑŒÑÑ.
# Ð¢Ð°ÐºÐ¾Ð¶ Ð±ÑƒÐ»Ð¾ Ð± Ð´Ð¾Ð±Ñ€Ðµ Ð¿Ð¾Ð·Ð±ÑƒÑ‚Ð¸ÑÑ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ– Ð²Ñ–Ð´ Ñ‚ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼Ñƒ (Ñ‡ÐµÑ€ÐµÐ· Ð½ÑŒÐ¾Ð³Ð¾, Ð´Ð¾ Ñ€ÐµÑ‡Ñ–, Ð¹ Ñ‚Ð°ÐºÐ° Ð½ÐµÑÑ‚Ð°Ð±Ñ–Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ)

[ -z "$1" ] && echo "Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ Ñƒ Ð½Ð°Ð·Ð¸Ð²Ð½Ð¾Ð¼Ñƒ Ð²Ñ–Ð´Ð¼Ñ–Ð½ÐºÑƒ Ð±ÐµÐ· ÑÐ»Ð¾Ð²Ð° \"Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ\".
ÐœÐ¾Ð¶Ð½Ð° ÑÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð·Ð²Ñ–Ð´ÑÐ¸ https://telegram.me/s/air_alert_ua" && exit

oblast="$1"
map="${XDG_CACHE_HOME:-$HOME/.cache}/alertmap.png"
hist="${XDG_CACHE_HOME:-$HOME/.cache}/alert"
now=$(curl -sL https://telegram.me/s/air_alert_ua | grep "$oblast Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ" | tail -1)

[ "$(tail -1 "$hist")" = "$now" ] || (echo "$now" >> "$hist" && notify-send -u critical "$(echo "$now" | sed -e 's/<[^>]*>//g; s/\..*//g' | head -n 1)")

tail -1 "$hist" | grep "Ñ‚Ñ€Ð¸Ð²Ð¾Ð³Ð°" >> /dev/null && echo ðŸ“¢ || echo ðŸ”±

case $BLOCK_BUTTON in
	1) notify-send "ÐœÐ¾Ð´ÑƒÐ»ÑŒ Ð¿Ð¾Ð²Ñ–Ñ‚Ñ€ÑÐ½Ð¾Ñ— Ñ‚Ñ€Ð¸Ð²Ð¾Ð³Ð¸" "Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ Ð¼Ð°Ð¿Ð¸..." & \
		curl -sL "https://alerts.com.ua/map.png" > "$map" && setsid nsxiv "$map" ;;
	2) notify-send "" ;;
	3) notify-send "" ;;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac;
